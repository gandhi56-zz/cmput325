
; Cmput 326 Winter 2020 Assignment 1
; Student ID 1523205 Student name Anshil Gandhi

; computes gcd(x, y)
(defun euclid (x y)
  (cond ((and (= x 0) (= y 0))  'GCD-ERROR        )
        ( (= y 0)               x                 )
        (t                  ( euclid y (mod x y)) )
        )
  )
; ------------------------------------------------------------------

; checks if E is a fraction
(defun isFrac (E)
  (if (and (integerp (car E)) (integerp (cdr E)) )
    t
    nil
    )
  )
; ------------------------------------------------------------------

; converts fraction to integer if possible
(defun fracToInt (F)
  (if (= (cdr F) 1)
    (car F)
    F
    )
  )
; ------------------------------------------------------------------

; converts integer to fraction
(defun intToFrac (N)
  (cons N 1)
  )
; ------------------------------------------------------------------

; divides numerator and denominator by their gcd
(defun sfHelper (F d)
  (cons (/ (car F) d) (/ (cdr F) d) )
  )

(defun simplifyFraction (F)
  (if (= (cdr F) 0)
    'ZERODIVIDE-ERROR
    (fracToInt (sfHelper F (euclid (car F) (cdr F))))
    )
  )
; ------------------------------------------------------------------

; ===================================
; || Binary expression evaluation  ||
; ===================================
;
; an integer is a binary expression
; (p . q) is a binary expression if p and q are integers
; if E1 and E2 are binary expressions, then (E1 + E2), (E1 - E2), (E1 * E2) and (E1 / E2) are binary expressions

; return the binary operation
(defun op (E) (cadr E))

(defun inv (F)
  (cons (cdr F) (car F))
  )

; add fractions
(defun addFrac (l r)
  (cons (+ (* (car l) (cdr r)) (* (car r) (cdr l)) ) (* (cdr l) (cdr r) ) )
  )

; subtract fractions
(defun subFrac (l r)
  (cons (- (* (car l) (cdr r)) (* (car r) (cdr l)) )( * (cdr l) (cdr r) ) )
  )

; multiply fractions
(defun mulFrac (l r)
  (cons (* (car l) (car r)) ( * (cdr l) (cdr r) ) )
  )

; divide fractions
(defun divFrac (l r)
  (mulFrac l (inv r))
  )

; checks for divide by zero error 
; for +, -, * on two binary expressions
(defun bad_denom (l r)
  (or (eq (cdr l) 0) (eq (cdr r) 0))
  )

; evaluate when l and r are known fractions
(defun evaluate (op l r)
  (cond 
        ((or (eq l 'ZERODIVIDE-ERROR) (eq r 'ZERODIVIDE-ERROR))
          'ZERODIVIDE-ERROR
          )
  
        ( (eq '+ op)
         (if (bad_denom l r)  'ZERODIVIDE-ERROR
            (sfHelper (addFrac l r) (euclid (car (addFrac l r)) (cdr (addFrac l r)) ) )
            )
         )
        ( (eq '- op)
         (if (bad_denom l r)  'ZERODIVIDE-ERROR
            (sfHelper (subFrac l r) (euclid (car (addFrac l r)) (cdr (addFrac l r)) ) )
            )
         )
        ( (eq '* op)
         (if (bad_denom l r)  'ZERODIVIDE-ERROR
            (sfHelper (mulFrac l r) (euclid (car (addFrac l r)) (cdr (addFrac l r)) ) )
            )
          )
        ( (eq '/ op)
         (if (bad_denom l (inv r))  'ZERODIVIDE-ERROR
            (sfHelper (divFrac l r) (euclid (car (addFrac l r)) (cdr (addFrac l r)) ) )
            )
          )
        )
  )

; checks if E already contains an error
(defun badExpr (E)
  (if (atom E)
    (if (eq E 'ZERODIVIDE-ERROR)
      t
      nil
      )

    (if (or (eq (first E) 'ZERODIVIDE-ERROR) (eq (third E) 'ZERODIVIDE-ERROR) )
      t
      nil
      )
    )
  )

; recursive evaluation of binary expression
; if E is an integer, then returns its equivalent fraction
; if E is a fraction, then reduce and return the fraction
; otherwise, evaluate the binary expression
(defun sbin(E)
  (cond
        ( (integerp E)   (intToFrac E)                           )
        ( (isFrac E )   (sfHelper E (euclid (car E) (cdr E)))   )
        ( t  
          (if (badExpr E)
            'ZERODIVIDE-ERROR
            (evaluate (op E) (sbin (car E)) (sbin (caddr E)))
            ) 
          )
      )
  )

; main driver function for binary expression evaluation
(defun simplifyBinary (E)
  (if (eq 'ZERODIVIDE-ERROR (sbin E))
    'ZERODIVIDE-ERROR
    (simplifyFraction (sbin E))
    )
  )

; ------------------------------------------------------------------

(defun big_op (op)
  (if (or (eq op '*) (eq op '/))
    t
    nil
    )
  )

(defun small_op (op)
  (if (or (eq op '+) (eq op '-))
    t
    nil
    )
  )

(defun is_op (op)
  (if (or (eq op '+) (eq op '-) (eq op '*) (eq op '/))
    t
    nil
    )
  )

(defun leftmost_op (E)
  (if (is_op (first E))
    (first E)
    (second E)
    )
  )

(defun get_op1 (E)
  (leftmost_op E)
  )

(defun get_op2 (E)
  (leftmost_op (cddr E))
  )

(defun case2_cond (op1 op2)
  (if (and (small_op op1) (big_op op2))
    t
    nil
    )
  )

(defun binarize (E)
  (if (or (atom E) (isFrac E))  ;; atom or numberp???
    E
    (cond
    ( (and (null (get_op1 E)) (null (get_op2 E)) )
        E  )    ; E is a number
    ( (null (get_op2 E))        
        (list (binarize (first E)) (second E) (binarize (third E)))  )    ; E is already a binary expression
    ( t 
        (if (case2_cond (get_op1 E) (get_op2 E))
            ; case 2
            (binarize (append (list 
                      (binarize (first E)) 
                      (second E) 
                      (list (binarize (third E)) (fourth E) (binarize (car (cddddr E))))
                    ) 
                    (cdr (cddddr E)) 
                ) 
              )

            ; case 1
            (binarize (append (list 
                      (list (binarize (first E)) (second E) (binarize (third E)))) 
                      (cdddr E)
                )
              )
          )
      )
    )

    )
  )
; ------------------------------------------------------------------
(defun test-case (ID Test Result)
    (if (equal Test Result)
        (format t "Test ~S OK~%" ID)
        (format t "FAIL: Test ~S expected ~S got ~S~%" ID Result Test)
    )
  )



; ------------------------------------------------------------------



; Main driver
(defun main ()

  ;; (binarize '((0 + 0 * 0) * 0 * (0 + (0 * 0 * 0 * 0 * 0))))
  (binarize '(0 + (0 + 0 * 0 * 0)))

  ; simplifybinary
  ;; (test-case "3.19" (simplifybinary '(0 * 0)) 0)
  ;; (test-case "3.20" (simplifybinary '((0 * 0) * (0 * 0))) 0)
  ;; (test-case "3.21" (simplifybinary '(((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0)))) 0)
  ;; (test-case "3.22" (simplifybinary '((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0)))
  ;;                                     *
  ;;                                     (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))) 0)
  ;; (test-case "3.23" (simplifybinary
  ;;                    '(((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                       (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))
  ;;                      *
  ;;                      ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                       (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0)))))
  ;;                    ) 0)
  ;; (test-case "3.24" (simplifybinary
  ;;                    '((((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))
  ;;                       *
  ;;                       ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0)))))
  ;;                      *
  ;;                      (((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))
  ;;                       *
  ;;                       ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))))
  ;;                    ) 0)
  ;; (test-case "3.25" (simplifybinary
  ;;                    '((((((0 * 0) * (0 + 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) + ((0 * 0) * (0 - 0))))
  ;;                       *
  ;;                       ((((0 * 0) - (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) + (0 * 0)))))
  ;;                      *
  ;;                      (((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) + (0 * 0)) + ((0 * 0) - (0 * 0))))
  ;;                       *
  ;;                       ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) - ((0 * 0) * (0 * 0))))))
  ;;                    ) 0)
  ;; (test-case "3.26" (simplifybinary
  ;;                    '((((((0 * 0) * (0 + 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) + ((0 * 0) * (0 - 0))))
  ;;                       *
  ;;                       ((((0 * 0) - (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) * ((0 * 0) + (0 * 0)))))
  ;;                      *
  ;;                      (((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) + (0 * 0)) + ((0 * 0) - (0 * 0))))
  ;;                       *
  ;;                       ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
  ;;                        (((0 * 0) * (0 * 0)) - ((0 * 0) * (0 / 0))))))
  ;;                    ) 'ZERODIVIDE-ERROR)
  ;; (test-case "3.27" (simplifybinary
  ;;                    '((((((1 + 2) - (3 * 4)) / ((5 + 6) - (7 * 8))) /
  ;;                        (((9 + 10) - (11 * 12)) / ((13 + 14) - (15 * 16))))
  ;;                       /
  ;;                       ((((17 + 18) - (19 * 20)) / ((21 + 22) - (23 * 24))) /
  ;;                        (((25 + 26) - (27 * 28)) / ((29 + 30) - (31 * 32)))))
  ;;                      /
  ;;                      (((((33 + 34) - (35 * 36)) / ((37 + 38) - (39 * 40))) /
  ;;                        (((41 + 42) - (43 * 44)) / ((45 + 46) - (47 * 48))))
  ;;                       /
  ;;                       ((((49 + 50) - (51 * 52)) / ((53 + 54) - (55 * 56))) /
  ;;                        (((57 + 58) - (59 * 60)) / ((61 + 62) - (63 * 64))))))
  ;;                    ) '(131988593110978197 . 308085605269311125))
  ;; (test-case "3.28" (simplifybinary
  ;;                    '((((((1 + 2) - (3 * 4)) / ((5 + 6) - (7 * 8))) /
  ;;                        (((9 + 10) - (11 * 12)) / ((13 + 14) - (15 * 16))))
  ;;                       /
  ;;                       ((((17 + 18) - (19 * 20)) / ((21 + 22) - (23 * 24))) /
  ;;                        (((25 + 26) - (27 * 28)) / ((29 + 30) - (31 * 32)))))
  ;;                      /
  ;;                      (((((33 + 34) - (35 * 36)) / ((37 + 38) - (39 * 40))) /
  ;;                        (((41 + 42) - (43 * 44)) / ((0 / 0) - (47 * 48))))
  ;;                       /
  ;;                       ((((49 + 50) - (51 * 52)) / ((53 + 54) - (55 * 56))) /
  ;;                        (((57 + 58) - (59 * 60)) / ((61 + 62) - (63 * 64))))))
  ;;                    ) 'ZERODIVIDE-ERROR)
  ;; (test-case "3.29" (simplifybinary
  ;;                    '((((((1 . 2) + (3 . 4)) - ((5 . 6) * (7 . 8))) /
  ;;                        (((9 . 10) + (11 . 12)) - ((13 . 14) * (15 . 16))))
  ;;                       /
  ;;                       ((((17 . 18) + (19 . 20)) - ((21 . 22) * (23 . 24))) /
  ;;                        (((25 . 26) + (27 . 28)) - ((29 . 30) * (31 . 32)))))
  ;;                      /
  ;;                      (((((33 . 34) + (35 . 36)) - ((37 . 38) * (39 . 40))) /
  ;;                        (((41 . 42) + (43 . 44)) - ((45 . 46) * (47 . 48))))
  ;;                       /
  ;;                       ((((49 . 50) + (51 . 52)) - ((53 . 54) * (55 . 56))) /
  ;;                        (((57 . 58) + (59 . 60)) - ((61 . 62) * (63 . 64))))))
  ;;                    )
  ;;            '(61202529293797639408750 . 109941528488902164907853))
  ;; (test-case "3.30" (simplifybinary
  ;;                    '((((((1 . 2) + 3) - (5 * (7 . 8))) /
  ;;                        (9 - ((13 . 14) * (15 . 16))))
  ;;                       /
  ;;                       ((((17 . 18) + (19 . 20)) - 21) /
  ;;                        25))
  ;;                      /
  ;;                      ((((33 + (35 . 36)) - ((37 . 38) * 39)) /
  ;;                        (((41 . 42) + (43 . 44)) - 45))
  ;;                       /
  ;;                       ((((49 . 50) + (51 . 52)) - ((53 . 54) * (55 . 56))) /
  ;;                        (((57 . 58) + (59 . 60)) - ((61 . 62) * (63 . 64))))))
  ;;                    )
  ;;            '(112098351017680000 . 74044505435119219))


  ;; binarize
  (princ (test-case "4.13"
            (binarize
              '(0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))) *
                (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))))
                *
                (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))) *
                (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) *
                  (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)))))))
            '((((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
                (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))
                *
                ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
                (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0)))))
              *
              (((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
                (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))
                *
                ((((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))) *
                (((0 * 0) * (0 * 0)) * ((0 * 0) * (0 * 0))))))
            ))
  (test-case "4.14"
            (binarize
              '(0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))) /
                (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))))
                /
                (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))) /
                (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) /
                  (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)))))))
            '((((((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))) /
                (((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))))
                /
                ((((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))) /
                (((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0)))))
              /
              (((((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))) /
                (((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))))
                /
                ((((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))) /
                (((0 / 0) / (0 / 0)) / ((0 / 0) / (0 / 0))))))
            )
  (test-case "4.15"
            (binarize
              '(0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))) +
                (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))))
                +
                (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))) +
                (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) +
                  (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)))))))
            '((((((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))) +
                (((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))))
                +
                ((((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))) +
                (((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0)))))
              +
              (((((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))) +
                (((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))))
                +
                ((((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))) +
                (((0 + 0) + (0 + 0)) + ((0 + 0) + (0 + 0))))))
            )
  (test-case "4.16"
            (binarize
              '(0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))) -
                (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))))
                -
                (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))) -
                (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) -
                  (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)))))))
            '((((((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))) -
                (((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))))
                -
                ((((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))) -
                (((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0)))))
              -
              (((((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))) -
                (((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))))
                -
                ((((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))) -
                (((0 - 0) - (0 - 0)) - ((0 - 0) - (0 - 0))))))
            )
  (test-case "4.17"
            (binarize
              '((1 . 2) * (3 . 4) * ((5 . 6) * (7 . 8)) * ((9 . 10) * (11 . 12) * ((13 . 14) * (15 . 16))) * ((17 . 18) * (19 . 20) * ((21 . 22) * (23 . 24)) * ((25 . 26) * (27 . 28) * ((29 . 30) * (31 . 32)))) *
                ((33 . 34) * (35 . 36) * ((37 . 38) * (39 . 40)) * ((41 . 42) * (43 . 44) * ((45 . 46) * (47 . 48))) * ((49 . 50) * (51 . 52) * ((53 . 54) * (55 . 56)) * ((57 . 58) * (59 . 60) * ((61 . 62) * (63 . 64)))))
                *
                ((65 . 66) * (67 . 68) * ((69 . 70) * (71 . 72)) * ((73 . 74) * (75 . 76) * ((77 . 78) * (79 . 80))) * ((81 . 82) * (83 . 84) * ((85 . 86) * (87 . 88)) * ((89 . 90) * (91 . 92) * ((93 . 94) * (95 . 96)))) *
                ((97 . 98) * (99 . 100) * ((101 . 102) * (103 . 104)) * ((105 . 106) * (107 . 108) * ((109 . 110) * (111 . 112))) *
                  ((113 . 114) * (115 . 116) * ((117 . 118) * (119 . 120)) * ((121 . 122) * (123 . 124) * ((125 . 126) * (127 . 128))))))))
            '(((((((1 . 2) * (3 . 4)) * ((5 . 6) * (7 . 8))) * (((9 . 10) * (11 . 12)) * ((13 . 14) * (15 . 16)))) *
                ((((17 . 18) * (19 . 20)) * ((21 . 22) * (23 . 24))) * (((25 . 26) * (27 . 28)) * ((29 . 30) * (31 . 32)))))
                *
                (((((33 . 34) * (35 . 36)) * ((37 . 38) * (39 . 40))) * (((41 . 42) * (43 . 44)) * ((45 . 46) * (47 . 48)))) *
                ((((49 . 50) * (51 . 52)) * ((53 . 54) * (55 . 56))) * (((57 . 58) * (59 . 60)) * ((61 . 62) * (63 . 64))))))
              *
              ((((((65 . 66) * (67 . 68)) * ((69 . 70) * (71 . 72))) * (((73 . 74) * (75 . 76)) * ((77 . 78) * (79 . 80)))) *
                ((((81 . 82) * (83 . 84)) * ((85 . 86) * (87 . 88))) * (((89 . 90) * (91 . 92)) * ((93 . 94) * (95 . 96)))))
                *
                (((((97 . 98) * (99 . 100)) * ((101 . 102) * (103 . 104))) * (((105 . 106) * (107 . 108)) * ((109 . 110) * (111 . 112)))) *
                ((((113 . 114) * (115 . 116)) * ((117 . 118) * (119 . 120))) * (((121 . 122) * (123 . 124)) * ((125 . 126) * (127 . 128)))))))
            )
  (test-case "4.18"
            (binarize
              '((1 . 2) / (3 . 4) / ((5 . 6) / (7 . 8)) / ((9 . 10) / (11 . 12) / ((13 . 14) / (15 . 16))) / ((17 . 18) / (19 . 20) / ((21 . 22) / (23 . 24)) / ((25 . 26) / (27 . 28) / ((29 . 30) / (31 . 32)))) /
                ((33 . 34) / (35 . 36) / ((37 . 38) / (39 . 40)) / ((41 . 42) / (43 . 44) / ((45 . 46) / (47 . 48))) / ((49 . 50) / (51 . 52) / ((53 . 54) / (55 . 56)) / ((57 . 58) / (59 . 60) / ((61 . 62) / (63 . 64)))))
                /
                ((65 . 66) / (67 . 68) / ((69 . 70) / (71 . 72)) / ((73 . 74) / (75 . 76) / ((77 . 78) / (79 . 80))) / ((81 . 82) / (83 . 84) / ((85 . 86) / (87 . 88)) / ((89 . 90) / (91 . 92) / ((93 . 94) / (95 . 96)))) /
                ((97 . 98) / (99 . 100) / ((101 . 102) / (103 . 104)) / ((105 . 106) / (107 . 108) / ((109 . 110) / (111 . 112))) /
                  ((113 . 114) / (115 . 116) / ((117 . 118) / (119 . 120)) / ((121 . 122) / (123 . 124) / ((125 . 126) / (127 . 128))))))))
            '(((((((1 . 2) / (3 . 4)) / ((5 . 6) / (7 . 8))) / (((9 . 10) / (11 . 12)) / ((13 . 14) / (15 . 16)))) /
                ((((17 . 18) / (19 . 20)) / ((21 . 22) / (23 . 24))) / (((25 . 26) / (27 . 28)) / ((29 . 30) / (31 . 32)))))
                /
                (((((33 . 34) / (35 . 36)) / ((37 . 38) / (39 . 40))) / (((41 . 42) / (43 . 44)) / ((45 . 46) / (47 . 48)))) /
                ((((49 . 50) / (51 . 52)) / ((53 . 54) / (55 . 56))) / (((57 . 58) / (59 . 60)) / ((61 . 62) / (63 . 64))))))
              /
              ((((((65 . 66) / (67 . 68)) / ((69 . 70) / (71 . 72))) / (((73 . 74) / (75 . 76)) / ((77 . 78) / (79 . 80)))) /
                ((((81 . 82) / (83 . 84)) / ((85 . 86) / (87 . 88))) / (((89 . 90) / (91 . 92)) / ((93 . 94) / (95 . 96)))))
                /
                (((((97 . 98) / (99 . 100)) / ((101 . 102) / (103 . 104))) / (((105 . 106) / (107 . 108)) / ((109 . 110) / (111 . 112)))) /
                ((((113 . 114) / (115 . 116)) / ((117 . 118) / (119 . 120))) / (((121 . 122) / (123 . 124)) / ((125 . 126) / (127 . 128)))))))
            )
  (test-case "4.19"
            (binarize
              '((1 . 2) / (3 . 4) / ((5 . 6) * (7 . 8)) / ((9 . 10) / (11 . 12) / ((13 . 14) / (15 . 16))) / ((17 . 18) / (19 . 20) / ((21 . 22) / (23 . 24)) / ((25 . 26) / (27 . 28) / ((29 . 30) / (31 . 32)))) /
                ((33 . 34) / (35 . 36) / ((37 . 38) / (39 . 40)) * ((41 . 42) / (43 . 44) / ((45 . 46) / (47 . 48))) / ((49 . 50) / (51 . 52) / ((53 . 54) / (55 . 56)) / ((57 . 58) / (59 . 60) / ((61 . 62) / (63 . 64)))))
                /
                ((65 . 66) / (67 . 68) / ((69 . 70) / (71 . 72)) / ((73 . 74) / (75 . 76) / ((77 . 78) / (79 . 80))) / ((81 . 82) / (83 . 84) / ((85 . 86) / (87 . 88)) / ((89 . 90) / (91 . 92) / ((93 . 94) / (95 . 96)))) /
                ((97 . 98) / (99 . 100) / ((101 . 102) / (103 . 104)) / ((105 . 106) / (107 . 108) / ((109 . 110) / (111 . 112))) /
                  ((113 . 114) / (115 . 116) / ((117 . 118) / (119 . 120)) / ((121 . 122) / (123 . 124) / ((125 . 126) / (127 . 128))))))))
            '(((((((1 . 2) / (3 . 4)) / ((5 . 6) * (7 . 8))) / (((9 . 10) / (11 . 12)) / ((13 . 14) / (15 . 16)))) /
                ((((17 . 18) / (19 . 20)) / ((21 . 22) / (23 . 24))) / (((25 . 26) / (27 . 28)) / ((29 . 30) / (31 . 32)))))
                /
                (((((33 . 34) / (35 . 36)) / ((37 . 38) / (39 . 40))) * (((41 . 42) / (43 . 44)) / ((45 . 46) / (47 . 48)))) /
                ((((49 . 50) / (51 . 52)) / ((53 . 54) / (55 . 56))) / (((57 . 58) / (59 . 60)) / ((61 . 62) / (63 . 64))))))
              /
              ((((((65 . 66) / (67 . 68)) / ((69 . 70) / (71 . 72))) / (((73 . 74) / (75 . 76)) / ((77 . 78) / (79 . 80)))) /
                ((((81 . 82) / (83 . 84)) / ((85 . 86) / (87 . 88))) / (((89 . 90) / (91 . 92)) / ((93 . 94) / (95 . 96)))))
                /
                (((((97 . 98) / (99 . 100)) / ((101 . 102) / (103 . 104))) / (((105 . 106) / (107 . 108)) / ((109 . 110) / (111 . 112)))) /
                ((((113 . 114) / (115 . 116)) / ((117 . 118) / (119 . 120))) / (((121 . 122) / (123 . 124)) / ((125 . 126) / (127 . 128)))))))
            )

  ;; simplify
  ;; (test-case "5.24"
  ;;            (simplify
  ;;             '(0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))) *
  ;;               (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))))
  ;;               *
  ;;               (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) * (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0))) *
  ;;                (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)) *
  ;;                 (0 * 0 * (0 * 0) * (0 * 0 * (0 * 0)))))))
  ;;            0)
  ;; (test-case "5.25"
  ;;            (simplify
  ;;             '(0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))) +
  ;;               (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))))
  ;;               +
  ;;               (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) + (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0))) +
  ;;                (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)) +
  ;;                 (0 + 0 + (0 + 0) + (0 + 0 + (0 + 0)))))))
  ;;            0)
  ;; (test-case "5.26"
  ;;            (simplify
  ;;             '(0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))) -
  ;;               (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))))
  ;;               -
  ;;               (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) - (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0))) -
  ;;                (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)) -
  ;;                 (0 - 0 - (0 - 0) - (0 - 0 - (0 - 0)))))))
  ;;            0)
  ;; (test-case "5.27"
  ;;            (simplify
  ;;             '(0 + 0 - (0 * 0) + (0 - 0 * (0 + 0)) - (0 * 0 + (0 - 0) * (0 + 0 - (0 * 0))) +
  ;;               (0 - 0 * (0 + 0) - (0 * 0 + (0 - 0)) * (0 + 0 - (0 * 0) + (0 - 0 * (0 + 0))))
  ;;               -
  ;;               (0 * 0 + (0 - 0) * (0 + 0 - (0 * 0)) + (0 - 0 * (0 + 0) - (0 * 0 + (0 - 0))) *
  ;;                (0 + 0 - (0 * 0) + (0 - 0 * (0 + 0)) -
  ;;                 (0 * 0 + (0 - 0) * (0 * 0 - (0 * 0)))))))
  ;;            0)
  ;; (test-case "5.28"
  ;;            (simplify
  ;;             '(0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))) /
  ;;               (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))))
  ;;               *
  ;;               (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) / (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0))) /
  ;;                (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)) /
  ;;                 (0 / 0 / (0 / 0) / (0 / 0 / (0 / 0)))))))
  ;;            'ZERODIVIDE-ERROR)
  ;; (test-case "5.29"
  ;;            (simplify
  ;;             '(0 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))))
  ;;               *
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;                (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) /
  ;;                 (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)))))))
  ;;            0)
  ;; (test-case "5.30"
  ;;            (simplify
  ;;             '(1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))))
  ;;               *
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;                (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) /
  ;;                 (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)))))))
  ;;            1)
  ;; (test-case "5.31"
  ;;            (simplify
  ;;             '(1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))))
  ;;               *
  ;;               (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) / (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2))) /
  ;;                (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)) /
  ;;                 (1 / 2 / (1 / 2) / (1 / 2 / (1 / 2)))))))
  ;;            1)
  ;; (test-case "5.32"
  ;;            (simplify
  ;;             '(1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3))) / (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3)))) /
  ;;               (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3))) / (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3)))))
  ;;               /
  ;;               (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3))) / (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3)))) /
  ;;                (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3))) /
  ;;                 (1 / (2 . 3) / (1 / (2 . 3)) / (1 / (2 . 3) / (1 / (2 . 3))))))))
  ;;            1)

  ;; ; substitutevar
  ;; (test-case "6.11"
  ;;            (substitutevar
  ;;             '((a 1) (b 1) (c 1) (d 1) (e 1) (f 1) (g 1) (h 1) (i 1) (j 1) (k 1) (l 1) (m 1) (n 1) (o 1) (p 1) (q 1) (r 1) (s 1) (t 1) (u 1) (v 1) (w 1) (x 1) (y 1) (z 1))
  ;;             '(a + b + c + d + e + f + g + h + i + j + k + l + m + n + o + p + q + r + s + t + u + v + w + x + y + z))
  ;;            '(1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1))
  ;; (test-case "6.12"
  ;;            (substitutevar
  ;;             '((a 2) (b 2) (c 2) (d 2) (e 2) (f 2) (g 2) (h 2) (i 2) (j 2) (k 2) (l 2) (m 2) (n 2) (o 2) (p 2) (q 2) (r 2) (s 2) (t 2) (u 2) (v 2) (w 2) (x 2) (y 2) (z 2))
  ;;             '(a + b + c + d + e + f + g + h + i + j + k + l + m + n + o + p + q + r + s + t + u + v + w + x + y + z))
  ;;            '(2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2 + 2))
  ;; (test-case "6.13"
  ;;            (substitutevar
  ;;             '((a (2 . 3)) (b (2 . 3)) (c (2 . 3)) (d (2 . 3)) (e (2 . 3)) (f (2 . 3)) (g (2 . 3)) (h (2 . 3)) (i (2 . 3)) (j (2 . 3)) (k (2 . 3)) (l (2 . 3)) (m (2 . 3)) (n (2 . 3)) (o (2 . 3)) (p (2 . 3)) (q (2 . 3)) (r (2 . 3)) (s (2 . 3)) (t (2 . 3)) (u (2 . 3)) (v (2 . 3)) (w (2 . 3)) (x (2 . 3)) (y (2 . 3)) (z (2 . 3)))
  ;;             '(a + b + c + d + e + f + g + h + i + j + k + l + m + n + o + p + q + r + s + t + u + v + w + x + y + z))
  ;;            '((2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3) + (2 . 3)))
  ;; (test-case "6.14"
  ;;            (substitutevar
  ;;             '((a 1) (b 2) (c 3) (d 4) (e 5) (f 6) (g 7) (h 8) (i 9) (j 10) (k 11) (l 12) (m 13) (n 14) (o 15) (p 16) (q 17) (r 18) (s 19) (t 20) (u 21) (v 22) (w 23) (x 24) (y 25) (z 26))
  ;;             '(a + b - c * d / e + f - g * h / i + j - k * l / m + n - o * p / q + r - s * t / u + v - w * x / y + z))
  ;;            '(1 + 2 - 3 * 4 / 5 + 6 - 7 * 8 / 9 + 10 - 11 * 12 / 13 + 14 - 15 * 16 / 17 + 18 - 19 * 20 / 21 + 22 - 23 * 24 / 25 + 26))
  ;; (test-case "6.15"
  ;;            (substitutevar
  ;;             '((z 26) (y 25) (x 24) (w 23) (v 22) (u 21) (t 20) (s 19) (r 18) (q 17) (p 16)
  ;;               (o 15) (n 14) (m 13) (l 12) (k 11) (j 10) (i 9) (h 8) (g 7) (f 6) (e 5) (d 4)
  ;;               (c 3) (b 2) (a 1))
  ;;             '(a + b - c * d / e + f - g * h / i + j - k * l / m + n - o * p / q + r - s * t / u + v - w * x / y + z))
  ;;            '(1 + 2 - 3 * 4 / 5 + 6 - 7 * 8 / 9 + 10 - 11 * 12 / 13 + 14 - 15 * 16 / 17 + 18 - 19 * 20 / 21 + 22 - 23 * 24 / 25 + 26))
  ;; (test-case "6.16"
  ;;            (substitutevar
  ;;             '((z 26) (y 25) (x 24) (w 23) (v 22) (u 21) (t 20) (s 19) (r 18) (q 17) (p 16)
  ;;               (o 15) (n 14) (m 13) (l 12) (k 11) (j 10) (i 9) (h 8) (g 7) (f 6) (e 5) (d 4)
  ;;               (c 3) (b 2) (a 1))
  ;;             '(a + a - a * a / a + a - a * a / a + a - a * a / a + a - a * a / a + a - a * a / a + a - a * a / a + a))
  ;;            '(1 + 1 - 1 * 1 / 1 + 1 - 1 * 1 / 1 + 1 - 1 * 1 / 1 + 1 - 1 * 1 / 1 + 1 - 1 * 1 / 1 + 1 - 1 * 1 / 1 + 1))
  ;; (test-case "6.17"
  ;;            (substitutevar
  ;;             '((a 1) (b 2) (c 3) (d 4) (e 5) (f 6) (g 7) (h 8) (i 9) (j 10) (k 11) (l 12) (m 13) (n 14) (o 15) (p 16) (q 17) (r 18) (s 19) (t 20) (u 21) (v 22) (w 23) (x 24) (y 25) (z 26))
  ;;             '(a + (b - (c * (d / (e + (f - (g * (h / (i + (j - (k * (l / (m + (n - (o * (p / (q + (r - (s * (t / (u + (v - (w * (x / (y + z))))))))))))))))))))))))))
  ;;            '(1 + (2 - (3 * (4 / (5 + (6 - (7 * (8 / (9 + (10 - (11 * (12 / (13 + (14 - (15 * (16 / (17 + (18 - (19 * (20 / (21 + (22 - (23 * (24 / (25 + 26))))))))))))))))))))))))))

  ;; ; simplifyvar
  ;; (test-case "7.17"
  ;;            (simplifyvar
  ;;             '((a 1) (b 2) (c 3) (d 4) (e 5) (f 6) (g 7) (h 8) (i 9) (j 10) (k 11) (l 12) (m 13) (n 14) (o 15) (p 16) (q 17) (r 18) (s 19) (t 20) (u 21) (v 22) (w 23) (x 24) (y 25) (z 26))
  ;;             '(a + b - c * d / e + f - g * h / i + j - k * l / m + n - o * p / q + r - s * t / u + v - w * x / y + z))
  ;;            '(9025949 . 348075))
  ;; (test-case "7.18"
  ;;            (simplifyvar
  ;;             '((a 1) (b 2) (c 3) (d 4) (e 5) (f 6) (g 7) (h 8) (i 9) (j 10) (k 11) (l 12) (m 13) (n 14) (o 15) (p 16) (q 17) (r 18) (s 19) (t 20) (u 21) (v 22) (w 23) (x 24) (y 0) (z 26))
  ;;             '(a + b - c * d / e + f - g * h / i + j - k * l / m + n - o * p / q + r - s * t / u + v - w * x / y + z))
  ;;            'zerodivide-error)
  ;; (test-case "7.19"
  ;;            (simplifyvar
  ;;             '((a (1 / 1))
  ;;               (b (1 + 1))
  ;;               (c (2 * 1 + 1))
  ;;               (d (2 * 2))
  ;;               (e (3 * 2 - 247 / 247))
  ;;               (f (37 - 37 + 2 * 3))
  ;;               (g ((-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + 8))
  ;;               (h (2 * (2 * 2)))
  ;;               (i (27 / 3))
  ;;               (j ((2 * 5 / 10 * 1 + 1 * 10 / 2 * 2) - 1))
  ;;               (k (55 / 5 * 6 / 11 + 5))
  ;;               (l (2 * 2 * 3))
  ;;               (m (3 * 2 - 7 / 7 + 1 * 2 * 4))
  ;;               (n (((-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7) + (-1 . 7)) * (0 - 2 * 7)))
  ;;               (o (3 * (1 + 2 + 3) - 3))
  ;;               (p (2 * 2 * 2 * 2))
  ;;               (q (-1 * 7 + 1 * 2 * 3 * 4))
  ;;               (r (1 * 2 * 3 * 4 * 5 / 2 / 5 + 6))
  ;;               (s (1 * 2 + 3 * 4 + 5))
  ;;               (t (1 / 2 / (1 / 40)))
  ;;               (u (1 + 2 + 3 + 4 + 5 + 6))
  ;;               (v (55 / 11 * 4 + 2))
  ;;               (w (-1 - -2 * 3 * 4))
  ;;               (x (2 * 3 * 4))
  ;;               (y ((1 * 2 + 3) * 4 + 5))
  ;;               (z (13 * -1 - 26 * -1 + 13)))
  ;;             '(a + b - c * d / e + f - g * h / i + j - k * l / m + n - o * p / q + r - s * t / u + v - w * x / y + z))
  ;;            '(9025949 . 348075))

  )
